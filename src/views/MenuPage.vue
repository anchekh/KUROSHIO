<template>
    <section class="m-first sector">
        <div class="m-hero">
            <div class="m-hero-logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="738" height="255" viewBox="0 0 738 255" fill="none">
                  <path d="M144.345 10.0645C143.053 12.2581 141.632 15.1613 140.082 18.7742C138.532 22.2581 137.241 25.1613 136.207 27.4839C133.882 33.9355 130.976 40.9677 127.489 48.5807C124.001 56.0645 120.061 63.6129 115.67 71.2258C111.278 78.8387 106.434 86.129 101.138 93.0968C95.1966 100.968 88.4153 108.903 80.7944 116.903C73.3027 124.774 64.713 132.516 55.0255 140.129C45.3379 147.742 34.2295 155.032 21.7002 162L0 142.452C17.696 133.935 32.9378 124.323 45.7254 113.613C58.513 102.774 69.9443 90.6452 80.0194 77.2258C87.8987 67.2903 94.1633 57.3548 98.8133 47.4194C103.593 37.3548 107.597 27.4839 110.826 17.8065C111.859 15.2258 112.763 12.2581 113.538 8.90323C114.443 5.41936 115.088 2.45162 115.476 0L144.345 10.0645ZM37.7816 28.8387C42.6899 31.8065 47.8567 35.1613 53.2817 38.9032C58.8359 42.5161 64.3901 46.2581 69.9443 50.129C75.6277 54 80.9882 57.8065 86.0257 61.5484C91.1924 65.2903 95.8425 68.7097 99.9758 71.8065C110.309 79.9355 120.384 88.3871 130.201 97.1613C140.018 105.935 148.866 114.516 156.745 122.903L136.789 144.968C128.264 135.161 119.609 126.129 110.826 117.871C102.043 109.484 92.5487 101.032 82.3444 92.5161C78.8569 89.5484 74.8527 86.3226 70.3318 82.8387C65.811 79.3548 60.9026 75.6774 55.6067 71.8065C50.44 67.9355 44.9504 64.0645 39.1378 60.1936C33.3253 56.1935 27.3836 52.3226 21.3127 48.5807L37.7816 28.8387Z" fill="white"/>
                  <path d="M207.702 20.9032C211.189 21.2903 215 21.6129 219.133 21.871C223.396 22 227.141 22.0645 230.371 22.0645C233.083 22.0645 236.7 22.0645 241.221 22.0645C245.742 22.0645 250.715 22.0645 256.14 22.0645C261.565 22.0645 267.054 22.0645 272.609 22.0645C278.292 22.0645 283.652 22.0645 288.69 22.0645C293.857 22.0645 298.378 22.0645 302.253 22.0645C306.128 22.0645 308.905 22.0645 310.584 22.0645C314.459 22.0645 318.334 21.9355 322.209 21.6774C326.084 21.4194 329.378 21.1613 332.09 20.9032V48.9677C329.378 48.8387 325.955 48.7097 321.821 48.5807C317.688 48.3226 313.942 48.1935 310.584 48.1935C308.905 48.1935 305.998 48.1935 301.865 48.1935C297.861 48.1935 293.146 48.1935 287.721 48.1935C282.296 48.1935 276.613 48.1935 270.671 48.1935C264.858 48.1935 259.24 48.1935 253.815 48.1935C248.39 48.1935 243.61 48.1935 239.477 48.1935C235.344 48.1935 232.373 48.1935 230.564 48.1935C226.819 48.1935 222.879 48.2581 218.746 48.3871C214.612 48.5161 210.931 48.7097 207.702 48.9677V20.9032ZM191.427 115.548C195.302 115.806 199.306 116.065 203.439 116.323C207.702 116.581 211.771 116.71 215.646 116.71C217.325 116.71 220.425 116.71 224.946 116.71C229.467 116.71 234.762 116.71 240.833 116.71C247.033 116.71 253.685 116.71 260.79 116.71C267.894 116.71 274.934 116.71 281.909 116.71C289.013 116.71 295.6 116.71 301.671 116.71C307.871 116.71 313.167 116.71 317.559 116.71C322.08 116.71 325.18 116.71 326.859 116.71C330.217 116.71 333.769 116.645 337.515 116.516C341.39 116.258 344.942 115.935 348.172 115.548V145.161C344.813 144.774 341.132 144.516 337.128 144.387C333.124 144.129 329.701 144 326.859 144C325.18 144 322.08 144 317.559 144C313.167 144 307.871 144 301.671 144C295.6 144 289.013 144 281.909 144C274.934 144 267.894 144 260.79 144C253.685 144 247.033 144 240.833 144C234.762 144 229.467 144 224.946 144C220.425 144 217.325 144 215.646 144C211.771 144 207.637 144.129 203.245 144.387C198.983 144.516 195.043 144.774 191.427 145.161V115.548Z" fill="white"/>
                  <path d="M515.573 60C515.056 61.2903 514.669 62.7097 514.411 64.2581C514.152 65.8065 513.894 67.0968 513.636 68.129C513.248 70.8387 512.667 74.5806 511.892 79.3548C511.246 84.129 510.471 89.4194 509.567 95.2258C508.792 100.903 507.952 106.645 507.048 112.452C506.144 118.258 505.304 123.548 504.529 128.323C503.883 133.097 503.302 136.903 502.785 139.742H476.242C476.758 137.032 477.339 133.613 477.985 129.484C478.631 125.226 479.342 120.645 480.117 115.742C481.021 110.71 481.796 105.677 482.442 100.645C483.217 95.6129 483.862 90.9677 484.379 86.7097C484.896 82.4516 485.219 79.0323 485.348 76.4516C483.539 76.4516 480.762 76.4516 477.017 76.4516C473.4 76.4516 469.266 76.4516 464.616 76.4516C460.096 76.4516 455.575 76.4516 451.054 76.4516C446.662 76.4516 442.852 76.4516 439.622 76.4516C436.393 76.4516 434.197 76.4516 433.035 76.4516C429.935 76.4516 426.577 76.5806 422.96 76.8387C419.472 76.9677 416.372 77.1613 413.66 77.4194V51.871C415.339 52.129 417.341 52.3226 419.666 52.4516C421.991 52.5806 424.316 52.7097 426.641 52.8387C429.095 52.9677 431.162 53.0323 432.841 53.0323C434.779 53.0323 437.427 53.0323 440.785 53.0323C444.143 53.0323 447.825 53.0323 451.829 53.0323C455.833 53.0323 459.837 53.0323 463.841 53.0323C467.846 53.0323 471.462 53.0323 474.692 53.0323C478.05 53.0323 480.633 53.0323 482.442 53.0323C483.862 53.0323 485.542 52.9677 487.479 52.8387C489.417 52.7097 491.29 52.5161 493.098 52.2581C494.906 51.871 496.133 51.4194 496.779 50.9032L515.573 60ZM395.835 130.258C398.418 130.516 401.389 130.774 404.747 131.032C408.235 131.161 411.658 131.226 415.016 131.226C416.954 131.226 420.506 131.226 425.672 131.226C430.968 131.226 437.168 131.226 444.272 131.226C451.506 131.226 458.933 131.226 466.554 131.226C474.304 131.226 481.667 131.226 488.642 131.226C495.746 131.226 501.817 131.226 506.854 131.226C511.892 131.226 515.121 131.226 516.542 131.226C518.996 131.226 522.161 131.161 526.036 131.032C529.911 130.903 533.075 130.71 535.53 130.452V155.419C534.238 155.29 532.429 155.161 530.104 155.032C527.909 155.032 525.584 154.968 523.129 154.839C520.804 154.839 518.738 154.839 516.929 154.839C515.379 154.839 512.021 154.839 506.854 154.839C501.688 154.839 495.552 154.839 488.448 154.839C481.344 154.839 473.852 154.839 465.973 154.839C458.223 154.839 450.731 154.839 443.498 154.839C436.393 154.839 430.258 154.839 425.091 154.839C419.924 154.839 416.566 154.839 415.016 154.839C411.658 154.839 408.558 154.839 405.716 154.839C402.874 154.968 399.58 155.161 395.835 155.419V130.258Z" fill="white"/>
                  <path d="M580.092 62.7097C582.417 62.8387 585.388 63.0323 589.005 63.2903C592.622 63.4194 596.368 63.5484 600.243 63.6774C604.247 63.8065 607.928 63.871 611.286 63.871C614.516 63.871 618.52 63.871 623.299 63.871C628.078 63.871 633.245 63.871 638.799 63.871C644.482 63.871 650.295 63.871 656.237 63.871C662.308 63.871 668.314 63.871 674.256 63.871C680.197 63.871 685.816 63.871 691.112 63.871C696.408 63.871 701.123 63.871 705.256 63.871C709.518 63.871 712.877 63.871 715.331 63.871C719.852 63.871 724.114 63.7419 728.119 63.4839C732.123 63.0968 735.417 62.8387 738 62.7097V93.0968C735.804 92.9677 732.51 92.7742 728.119 92.5161C723.727 92.2581 719.464 92.129 715.331 92.129C712.877 92.129 709.518 92.129 705.256 92.129C700.993 92.129 696.214 92.129 690.918 92.129C685.622 92.129 680.004 92.129 674.062 92.129C668.249 92.129 662.308 92.129 656.237 92.129C650.166 92.129 644.289 92.129 638.605 92.129C633.051 92.129 627.884 92.129 623.105 92.129C618.455 92.129 614.516 92.129 611.286 92.129C605.732 92.129 600.049 92.2581 594.236 92.5161C588.424 92.6452 583.709 92.8387 580.092 93.0968V62.7097Z" fill="white"/>
                  <path d="M247 198.759H259.394L275.992 238.962H276.647L293.245 198.759H305.639V254.241H295.92V216.124H295.401L279.95 254.079H272.689L257.237 216.043H256.719V254.241H247V198.759Z" fill="#5F8484"/>
                  <path d="M316.667 254.241V198.759H353.03V207.184H326.795V222.247H351.146V230.672H326.795V245.816H353.248V254.241H316.667Z" fill="#5F8484"/>
                  <path d="M363.363 254.241V198.759H373.491V222.247H399.398V198.759H409.553V254.241H399.398V230.672H373.491V254.241H363.363Z" fill="#5F8484"/>
                  <path d="M430.696 198.759V254.241H420.568V198.759H430.696ZM442.79 223.276V231.349H425.182V223.276H442.79ZM491 226.5C491 232.478 489.872 237.598 487.615 241.861C485.376 246.105 482.319 249.356 478.442 251.614C474.584 253.871 470.207 255 465.311 255C460.416 255 456.03 253.871 452.153 251.614C448.295 249.338 445.237 246.078 442.981 241.834C440.742 237.571 439.623 232.46 439.623 226.5C439.623 220.522 440.742 215.411 442.981 211.166C445.237 206.904 448.295 203.644 452.153 201.386C456.03 199.129 460.416 198 465.311 198C470.207 198 474.584 199.129 478.442 201.386C482.319 203.644 485.376 206.904 487.615 211.166C489.872 215.411 491 220.522 491 226.5ZM480.817 226.5C480.817 222.292 480.153 218.743 478.825 215.853C477.514 212.945 475.694 210.751 473.365 209.27C471.035 207.771 468.351 207.021 465.311 207.021C462.272 207.021 459.588 207.771 457.258 209.27C454.929 210.751 453.1 212.945 451.771 215.853C450.461 218.743 449.806 222.292 449.806 226.5C449.806 230.708 450.461 234.266 451.771 237.174C453.1 240.064 454.929 242.258 457.258 243.757C459.588 245.238 462.272 245.979 465.311 245.979C468.351 245.979 471.035 245.238 473.365 243.757C475.694 242.258 477.514 240.064 478.825 237.174C480.153 234.266 480.817 230.708 480.817 226.5Z" fill="#5F8484"/>
                </svg>
            </div>
        </div>
    </section>
    <section class="m-second sector">
      <div class="categories">
        <div v-for="category in categories" :key="category.id" class="category-item" :class="{ 'active': activeCategory === category.id }" @click="setActiveCategory(category.id)">{{ category.name }}</div>
      </div>
      <div class="products">
        <div v-for="(item, index) in filteredItems" :key="index" class="product-item">
          <div class="product-img">
            <div v-if="loadingIndex === index" class="spinner-overlay">
              <pulse-loader color="#5F8484"></pulse-loader>
            </div>
            <img :src="item.image" :alt="item.title">
            <div class="product-description">{{ item.description }}</div>
          </div>
          <div class="product-top-part">
            <div class="product-title">{{ item.title }}</div>
            <div class="product-price">{{ item.price }} р</div>
          </div>
          <div class="product-bottom-part">                    
            <div class="product-add-to-order">
              <button class="add-to-order-btn" @click="addToCart(item, index)" :disabled="loadingIndex === index">{{ loadingIndex === index ? "Добавляем..." : "Добавить в заказ" }}</button>            
            </div>
          </div>
        </div>
      </div>
    </section>
</template>

<script>
import menuItems from "@/data/menu-items";
import { ref } from "vue";
import PulseLoader from "vue-spinner/src/PulseLoader.vue";
import { useStore } from "vuex";

export default {
  components: {
    PulseLoader
  },
  data() {
    return {
      menuItems: menuItems,
      activeCategory: "all",
      categories: [
        { id: "all", name: "Все" },
        { id: "ramen", name: "Рамены" },
        { id: "snacks", name: "Закуски" },
        { id: "gyoza", name: "Гедза" },
        { id: "rolls", name: "Роллы" },
        { id: "sushi", name: "Суши" },
        { id: "noodles", name: "Лапша" },
        { id: "rice", name: "Рис" },
        { id: "desserts", name: "Десерты" }
      ]
    }
  },
  computed: {
    filteredItems() {
      if (this.activeCategory === "all") {
        const allItems = [];
        
        allItems.push.apply(allItems, this.menuItems.ramen);
        allItems.push.apply(allItems, this.menuItems.snacks);
        allItems.push.apply(allItems, this.menuItems.gyoza);
        allItems.push.apply(allItems, this.menuItems.rolls);
        allItems.push.apply(allItems, this.menuItems.sushi);
        allItems.push.apply(allItems, this.menuItems.noodles);
        allItems.push.apply(allItems, this.menuItems.rice);
        allItems.push.apply(allItems, this.menuItems.desserts);
        
        return allItems;
      }
      return this.menuItems[this.activeCategory];
    }
  },
  methods: {
    setActiveCategory(category) {
      this.activeCategory = category;
    }
  },
  setup() {
    const store = useStore()
    const loadingIndex = ref(null)
    const addToCart = (item, index) => {
      loadingIndex.value = index
      
      setTimeout(() => {
        store.dispatch("addToCart", {
          id: item.id,
          title: item.title,
          price: item.price,
          image: item.image,
          description: item.description
        })
        loadingIndex.value = null
      }, 1000);
    }

    return {
      loadingIndex,
      addToCart
    }
  }
}
</script>

<style>
.product-img {
  position: relative;
}

.add-to-order-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.m-first {
  background-color: #0E0E0E;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-left: 0;
}

.m-hero {
  width: 100vw;
  height: 454px;
  background-image: url("@/assets/images/main-image230.png");
  margin-top: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.m-hero-logo {
  z-index: 1;
}

.m-second {
  height: auto;
}

.categories {
  display: flex;
  justify-content: center;
  padding-top: 80px;
  /* margin-left: 80px; */
  /* margin-right: 80px; */
  width: 100%;
  gap: 20px;
}

.category-item {
  font-size: 20px;
  width: 100px;
  text-align: center;
  cursor: pointer;
}

.products {
  padding-top: 20px;
  margin-left: 80px;
  margin-right: 80px;
  width: auto;
  display: grid;
  grid-template-columns: repeat(5, auto);
  gap: 14px;
}

.product-item {
  width: 340px;
  height: 340px;
  background-color: #151515;
  /* border: 2px solid #5F8484; */
  border-radius: 12px;
  transition: all 0.3s ease;
  box-shadow: 0 2px 10px rgba(255, 255, 255, 0.05);
  position: relative;
  overflow: hidden;
}

.product-item:hover {
  transform: scale(1.03);
  z-index: 1;
  box-shadow: 0 5px 20px rgba(255, 255, 255, 0.1);
}

.product-img > img{
  width: 100%;
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
}

.product-img {
  position: relative;
  transition: opacity 0.3s ease;
}

.product-img img {
  display: block;
  width: 100%;
  height: auto;
  transition: opacity 0.3s ease;
}

.product-description {
  position: absolute;
  top: 0;
  left: 0;
  font-size: 16px;
  text-align: justify;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  padding: 15px;
  box-sizing: border-box;
  background-color: rgba(0, 0, 0, 0.7);
  color: #fff;
  display: flex;
  align-items: center;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
}

.product-item:hover .product-img img {
  opacity: 0.5;
}

.product-item:hover .product-description {
  opacity: 1;
}

.product-title {
  font-size: 18px;
  margin-left: 5px;
  margin-top: 5px;
}

.product-price {
  font-size: 16px;
  margin-left: 5px;
  margin-top: 5px;
  color: #5F8484;
}

.product-top-part {
  width: 100%;
  height: 56px;
}

.product-bottom-part {
  width: 100%;
  height: 50px;
  display: flex;
  justify-content: center;
}

.product-add-to-order {
  /* display: flex; */
  font-size: 8px;
  /* align-items: center;
  justify-content: center; */
  margin-left: 10px;
  margin-right: 10px;
}

.add-to-order-btn {
  /* margin-top: 8px; */
  width: 220px;
  height: 44px;
  color: #FFF;
  background-color: #5F8484;
  border-radius: 50px;
  font-size: 16px;
}

button {
  background-color: #0E0E0E;
  border: 2px solid #5F8484;
  cursor: pointer;
}

.category-item.active {
  color: #5F8484;
  /* font-weight: bold; */
}

.spinner-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: rgba(12, 12, 12, 0.6);
  z-index: 10;
}
</style>